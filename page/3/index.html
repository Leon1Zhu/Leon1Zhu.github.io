<!DOCTYPE html>






  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">


<script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/946688f7.js","daovoice")
daovoice('init', {
  app_id: "946688f7"
});
daovoice('update');
</script>













<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.2.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=6.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=6.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=6.2.0">


  <link rel="mask-icon" href="/images/favicon.ico?v=6.2.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  






  <meta name="description" content="Leon Zhu’s blog | 爱前端 | 爱生活">
<meta property="og:type" content="website">
<meta property="og:title" content="朱亮的博客">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="朱亮的博客">
<meta property="og:description" content="Leon Zhu’s blog | 爱前端 | 爱生活">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="朱亮的博客">
<meta name="twitter:description" content="Leon Zhu’s blog | 爱前端 | 爱生活">






  <link rel="canonical" href="http://yoursite.com/page/3/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>朱亮的博客</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">朱亮的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">码农，程序猿，未来的昏析师</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-schedule">
    <a href="/schedule/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br />日程表</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/22/web前端优化（8）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="朱亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朱亮的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/22/web前端优化（8）/" itemprop="url">
                  web前端优化（8）
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-11-22 22:54:52" itemprop="dateCreated datePublished" datetime="2017-11-22T22:54:52+08:00">2017-11-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-25 13:20:04" itemprop="dateModified" datetime="2017-11-25T13:20:04+08:00">2017-11-25</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##解决首屏渲染慢的问题的几种方法</p>
<ul>
<li>构建层模板编译（在构建层直接进行模板编译）</li>
<li>对数据无关的页面做一个prerender</li>
<li>服务端渲染（内存泄露，服务器端压力等等问题）</li>
</ul>
<p>##为什么需要使用ssr服务端加载</p>
<ul>
<li>在使用现代的react或者vue之类的框架时，服务端是先将打包后的在template里面的页面代码返回到客户端，但是客户端并不会直接开始渲染，而是要等待vue或者react的框架代码加载完成之后，才能对template里面的代码进行解析，借解析完成自后才能进行渲染，这也就导致了首屏渲染慢的问题。所以需要使用服务端渲染，将代码再服务端就渲染好，加载到客户端时直接进行渲染即可。</li>
<li>使用服务端渲染不会有mounted钩子，需要在服务端渲染的时候进行处理</li>
</ul>
<p>##服务端渲染（SSR）实践(nuxt.js)</p>
<ul>
<li>在任何vue组件的生命周期内，只有beforeCreate和created这两个钩子会在浏览器端和服务端均被调用；其他的钩子都只会在浏览器端调用。</li>
<li>对于axios这种ajax请求插件，无疑会使用在页面的方方面面中，那么如果在每个页面中使用import方式进行引入，会导致在打包的时候打包多次。而实际上我们只需要打包一次，可以通过在nuxt.config.js里面的build.vendor来解决。<br><img src="http://otdc3q7z7.bkt.clouddn.com/6540FAED-99E9-4A91-847A-F27405C351C5.png" alt=""><br>当然，如果你需要区分测试环境和线上环境的接口地址，就需要在plugins文件中对axios进行编写，如图：<br><img src="http://otdc3q7z7.bkt.clouddn.com/6540FAED-99E9-4A91-847A-F27405C351C5.png" alt=""></li>
</ul>
<p>参考资源<a href="https://juejin.im/post/598aabe96fb9a03c335a8dde" target="_blank" rel="external">https://juejin.im/post/598aabe96fb9a03c335a8dde</a></p>
<p>nuxt.js官网(<a href="https://zh.nuxtjs.org/" target="_blank" rel="external">https://zh.nuxtjs.org/</a>)</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/22/web前端优化-缓存-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="朱亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朱亮的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/22/web前端优化-缓存-1/" itemprop="url">
                  web前端优化（7）
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-11-22 20:25:25 / 修改时间：20:36:45" itemprop="dateCreated datePublished" datetime="2017-11-22T20:25:25+08:00">2017-11-22</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##浏览器的缓存</p>
<ul>
<li>大规模的文件存储需要浏览器和服务器之间约定一个缓存大文件的缓存方式</li>
</ul>
<h2 id="cache-control所控制的缓存策略"><a href="#cache-control所控制的缓存策略" class="headerlink" title="cache-control所控制的缓存策略"></a>cache-control所控制的缓存策略</h2><ul>
<li>可以出现在http responseheader 或者http requestheader中</li>
<li>max-age指定缓存的最大时间，在这段时间内，不会向服务端重新请求（相对过期时间，max-age的优先级更高）</li>
<li>s-maxage s-maxage返回状态304，也是定义缓存的最大时间，但是只能针对public的缓存 （优先级高于max-age，设置之后要去public缓存区拿）</li>
<li>private私人的缓存设备，只能私人用户使用</li>
<li>public比如cdn服务器，可以被很多用户访问并且获取信息的</li>
<li>no-cache 搭配max-age=0配置，每次都会发发起请求，询问我当前的文件是否过期，从而知道缓存策略是什么样的</li>
<li>no-store 完全不使用缓存策略</li>
</ul>
<ul>
<li>Expires<ul>
<li>设置缓存过期时间，过期之前都可以直接从缓存读取（max-age(http1.1)的优先级高于expires（http1.0））</li>
</ul>
</li>
</ul>
<p>##last-modified和etagg以及整个服务端浏览器端的存储过程</p>
<ul>
<li>Last-Modified/If-Modified-Since<ul>
<li>last-modified– response header客户端拿到，服务端这告诉客户端个文件的最后修改时间</li>
<li>if-modified-since – request header客户端告诉服务端当前文件客户端知道的最后修改时间，如果服务端没有更新，返回304成功状态，表示没有更新，可以使用，如果有修改，返回200状态码，返回最新文件，此时需要使用返回的最新的文件，不需要从缓存中读取</li>
<li>第一次请求，客户端不会携带if-modified-since的参数</li>
</ul>
</li>
<li>last-modified缺点<ul>
<li>服务端可能没有精确的修改时间</li>
<li>有些文件修改时间是改了，但是文件内容是没有修改</li>
</ul>
</li>
<li>etagg(If-None-Match，优先级高于last-modified)<ul>
<li>Response Header中返回 ETag（文件的hash值）</li>
<li>request Headers中带If-None-Match参数，这个参数是ETag传递回来的hash值</li>
<li>etag是记住当前文件的hash值，当文件的hash值改变时，表示文件变动，返回200，否则是304状态</li>
<li>也需要和cache-control一起使用<br><img src="http://otdc3q7z7.bkt.clouddn.com/E394114D-4422-499E-90AD-C0C3317E957C.png" alt="缓存流程last-modified和etagg"><br><img src="http://otdc3q7z7.bkt.clouddn.com/3DD6BC6C-F4D3-4CC6-A3C8-7B96F57FC9C6.png" alt="缓存流程cache-control"></li>
</ul>
</li>
</ul>
<p>##案例分析和基于node实践缓存方式</p>
<p>chrome下使用 chrome://cache可以直接查看到当前的cache</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/18/web前端优化（6）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="朱亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朱亮的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/18/web前端优化（6）/" itemprop="url">
                  web前端优化（6）
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-11-18 19:32:12" itemprop="dateCreated datePublished" datetime="2017-11-18T19:32:12+08:00">2017-11-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-22 20:42:36" itemprop="dateModified" datetime="2017-11-22T20:42:36+08:00">2017-11-22</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="service-worker实战"><a href="#service-worker实战" class="headerlink" title="service worker实战"></a>service worker实战</h2><ul>
<li>service worker可以做的事<ul>
<li>后台消息传递</li>
<li>网络代理，转发请求，伪造响应</li>
<li>离线缓存</li>
<li>消息推送</li>
<li>……</li>
</ul>
</li>
</ul>
<ul>
<li><p>注册当前的service worker</p>
<pre><code>if(navigator.serviceWorker){
      navigator.serviceWorker.register(&apos;./service-worker.js&apos;,{scope : &apos;./&apos;})
        .then( function(reg){
          console.log(reg)
        })/*.catch(fu nction(error){
          console.log(error)
      })*/
}else{
  alert(&quot;Service Worker is not support&quot;)
}
</code></pre></li>
<li><p>编写service-worker.js</p>
<pre><code>self.addEventListener(&quot;install&quot;,function(e){
  //waitUntil表示知道里面的异步方法执行完成，才会进行下一步
  e.waitUntil(
    caches.open(&apos;app-v1&apos;).then(function(cache){
      console.log(&apos;open cache&apos;)
      return cache.addAll([
        &apos;./app.js&apos;,
        &apos;./main.css&apos;,
        &apos;./service-worker.js&apos;
      ]);
    })
  )
})

//fetch可以请求拦截和响应
self.addEventListener(&quot;fetch&quot;, function(event){
  //改变response返回的数组
  event.respondWith(
    //改变请求返回的资源，如果serviceWorker中有，就直接返回，否则就启用fetch进行请求
    caches.match(event.request).then(function(res){
      if(res){
        return res;
      }else{
        //通过fetch方法向网络发起请求
       /* fetch(url).then(function(){
          if(res){
             //对于新请求的资源存储搭配我们的cachestorage中
          }else{
             //用户提示
          }
        })*/

      }
      return fetch(event.request)
    })
  )
})
</code></pre></li>
<li><p>其中self 属性可返回对窗口自身的只读引用。等价于 Window 属性</p>
</li>
<li>install是service worker的一个生命周期 waitUntil表示当其中的promise都执行完之后才会继续往下执行</li>
<li>service worker会拦截对应的fetch请求进行对应的处理</li>
<li>service worker还有message事件，可以用来各个页面之间的通信<br><img src="http://otdc3q7z7.bkt.clouddn.com/E0F3B907-EE45-44CA-A140-9B4BDA100ACE.png" alt="第一次执行之后的cachestorage缓存的数据"></li>
</ul>
<p><img src="http://otdc3q7z7.bkt.clouddn.com/3E42AB1C-451E-422A-8247-59DD2AA68D28.png" alt="第一次刷新发现，需要的文件都从缓存中读取，实现了离线应用的需求"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/16/web前端优化（5）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="朱亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朱亮的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/16/web前端优化（5）/" itemprop="url">
                  web前端优化（5）
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-11-16 17:47:27" itemprop="dateCreated datePublished" datetime="2017-11-16T17:47:27+08:00">2017-11-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-18 17:05:42" itemprop="dateModified" datetime="2017-11-18T17:05:42+08:00">2017-11-18</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="cookie相关"><a href="#cookie相关" class="headerlink" title="cookie相关"></a>cookie相关</h2><ul>
<li>cookie的本意是用来与服务端通信，告诉服务端当前调用的人的相关信息，方便服务端及时的知道是那些人在调用后台的数据</li>
<li>每次发送http请求时，都会自动的吧cookie信息带上</li>
<li>cookie的大小为4MB</li>
<li>cookie具有时效性</li>
<li>在dns服务器上，如果使用cookie来存储信息的话，并且在相同域名下请求静态资源文件，那么因为请求会自动带上cookie这一项而浪费很多的流量，例如京东这样的公司，如果dns服务器进行cookie操作的话，光是对静态资源的请求，就会浪费上亿元的流量费</li>
<li>cookie并不适合做浏览器端数据的存储</li>
<li>cookie具有httponly的设置，防止js的恶意读取<h2 id="sessionStorage和LocalStorage"><a href="#sessionStorage和LocalStorage" class="headerlink" title="sessionStorage和LocalStorage"></a>sessionStorage和LocalStorage</h2></li>
<li>这两个是H5为了浏览器存储而设计的</li>
<li>仅在客户端使用，不和服务端通信</li>
<li>5MB大小</li>
<li>使用storage进行缓存数据，可以减少对于后端的http请求，进行一定的优化</li>
<li>sessionStorage是会话级别的浏览器存储</li>
<li>loaclStorage是直接存储在本地</li>
<li>百度在loaclStorage中存储了很多的信息，包括百度地图的js、函数级别的缓存和css级别的缓存，但是要注意要有一个很好的更新机制</li>
<li>手淘将很多的小的icon图片都存在loaclstorage中，同样也很好加快了网页的读取速度，用户数据还是放在了cookie中，随请求发送到后端，手淘中将浏览器是否支持webp格式的图片字段放在了sessionStorage中，因为这个字段是会每次随浏览器的改变都会改变</li>
</ul>
<h2 id="indexDB浏览器端数据库"><a href="#indexDB浏览器端数据库" class="headerlink" title="indexDB浏览器端数据库"></a>indexDB浏览器端数据库</h2><ul>
<li>用于客户端存储大量结构化数据，大数据量存储就使用这个</li>
<li>可以为应用创建离线版本</li>
</ul>
<h2 id="Service-Workers"><a href="#Service-Workers" class="headerlink" title="Service Workers"></a>Service Workers</h2><ul>
<li>Service Worker是一个脚本可以将一些运行时间比较长或者不依赖页面的JS放在后台运行</li>
<li>Service Worker可以拦截请求，将需要到后台请求资源的请求拦截下来，直接从Service Worker的缓存数据中进行请求（离线应用就是一个比较重要的能力）</li>
<li>Service Worker可以实现与主页面的通信，可以将大规模的运算放在Service Worker中进行运算，结束之后通过API进行通信</li>
<li>当前端需要大批量的运算和获取时，使用Service Workers可以避免对UI渲染的堵塞</li>
<li>在谷歌中，使用chrome://inspect/#/service-workers可以查看当前浏览器有多少service worker在运行</li>
<li>使用chrome://serviceworker-internals可以查看service-worker的历史，用来查看浏览过的网站，那些使用了service-worker</li>
<li>目前苹果设备对service-worker的支持不是很好</li>
<li>service Worker目前只支持https的站点，http的站点不支持，但是对localhost的本地地址进行了过滤<br><img src="http://otdc3q7z7.bkt.clouddn.com/1758B00C-BD65-4FD8-AC81-0ED2A1151E3D.png" alt="Service Work的生命周期"><ul>
<li><h2 id="PWA-Progressive-Web-Apps"><a href="#PWA-Progressive-Web-Apps" class="headerlink" title="PWA(Progressive Web Apps)"></a>PWA(Progressive Web Apps)</h2></li>
</ul>
</li>
<li>PWA是一种WebApp的新模型，并不是单一的知识点，它通过一系列新的WEB特性，配合优秀的UI交互设计，逐步增强WebApp的用户体验</li>
<li>渐进式（弱网环境下，是否可以加载出来，没有网的时候能不能加载出来，然后渐进式的提升用体验）</li>
<li>可靠：在没有网络的情况下也能访问提供的基本页面，而不是出现“没有连接到互联网的提示”</li>
<li>快速：针对网页渲染和书库访问有较好的优化</li>
<li>融入：应用可以被增加到手机桌面，并且和普通应用一样有全屏，推送等特性</li>
</ul>
<p>##使用lightHouse对页面进行性能检验</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/15/web前端优化（4）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="朱亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朱亮的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/15/web前端优化（4）/" itemprop="url">
                  web前端优化（4）
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-11-15 12:37:53" itemprop="dateCreated datePublished" datetime="2017-11-15T12:37:53+08:00">2017-11-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-23 19:31:29" itemprop="dateModified" datetime="2017-11-23T19:31:29+08:00">2017-11-23</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="重绘与回流"><a href="#重绘与回流" class="headerlink" title="重绘与回流"></a>重绘与回流</h2><p>####浏览器的重绘与回流的机制</p>
<ul>
<li>频繁触发重绘与回流，会导致UI频繁渲染，降低js的运行性能，所以要对css的性能进行提高</li>
<li>当render tree中的一部分因为元素的规模尺寸、布局、隐藏等改变需要重新构建，就是回流。比如。通过减少会触发回流的css的使用，可以对回流进行优化</li>
<li>当render-tree中的一些元素需要更新属性，而这些属性只是影响元素的外观、风格。而不影响布局时，就是重绘，比如（background-color）。</li>
<li>重绘的时候不一定会回流，但是回流一定会引起重绘。</li>
</ul>
<ul>
<li>会触发重绘与回流的css属性<ol>
<li>触发页面重布局的属性<br><img src="http://otdc3q7z7.bkt.clouddn.com/6BB86E46-CFA6-493C-90BC-319D16AD0FD9.png" alt="触发页面重布局的css属性"></li>
<li>只触发重绘的属性<br><img src="http://otdc3q7z7.bkt.clouddn.com/202F0A54-AB47-4689-B95E-966B8254F489.png" alt="只触发重绘的属性"></li>
</ol>
</li>
<li>针对重构与回流的优化<ul>
<li>css维度</li>
</ul>
<ul>
<li>图层维度(chrome创建图层的条件)<ol>
<li>3D透视变换CSS属性</li>
<li>使用加速视频解码<video>节点</video></li>
<li>拥有3D上下文（WEBGL）或者2D（canvas）</li>
<li>混合插件</li>
<li>对自己的opcaity做css动画或者使用一个动画webkit变换的元素</li>
<li>拥有加速CSS过滤器的元素</li>
<li>元素有一个包含复合层的后代节点（一个元素拥有一个子元素，这个子元素在自己的层里）</li>
<li>元素有一个z-index较低且包含一个复合层的兄弟元素（就是该元素在复合层上面渲染）</li>
</ol>
</li>
</ul>
</li>
</ul>
<ul>
<li>尽量避免使用触发重绘、回流的css</li>
<li>将重绘、回流的范围控制在单独的图层内</li>
<li>学会使用谷歌浏览器的performance工具来观察网页的性能</li>
<li>在谷歌的开发和工具中的更多工具中可以看到当前页面的layers的布局，以及为什么会有这么多layers的原因</li>
<li>谷歌开发者工具中的rendering可以直观的看到当前页面移动之后进行重绘的元素</li>
<li>为元素添加-webkit-transform:transition3d(0,0,0)或-webkit-transform:translateZ(0);属性都会开启GPU的硬件加速，应为浏览器认为这是3D变换，会自动为其设置图层,或者使用will-chang:transform也可以完成新建图层的操作</li>
<li>具体案例具体分析，不要盲目的使用图层</li>
</ul>
<ul>
<li>具体的css替换方案<ol>
<li>使用translate替换top的改变</li>
<li>使用opacity替换visibility</li>
<li>DOM样式不要一条条修改，都定义在一个className中，集中修改</li>
<li>DOM离线修改，将元素设置为display：none，然后对元素修改100次再显示出来，这样之用重绘一次（元素出现的时候重绘）</li>
<li>DOM节点的属性千万不要放在循环的变量里（offsetHeight，offsetWidth）每获取一次都会刷新dom的缓存，然后需要重新去回流</li>
<li>不要使用table布局，可能一个很小的改动就会造成整个table的重新布局（30行的table，修改最后一行，回流的时间需要1.15ms，使用div的话只需要0.1ms）</li>
<li>对gif图使用单独的图层，这样gif图的改变就不会涉及到整个页面的修改了</li>
</ol>
</li>
</ul>
<ul>
<li>动画实现速度要与网页的渲染速度相均衡，否则css的渲染可能导致阻塞js的加载</li>
<li>使用位置变换时，如果使用了3d变换，那么会启用GPU的能力开启硬件加速，代价就是原来的数据从CPU走总线到GPU，如果数据过多，那么传输的损耗也是一个需要权衡的问题<br><img src="http://otdc3q7z7.bkt.clouddn.com/E2526202-CD86-411D-B415-73C8CC7B2482.png" alt="优化点总结"></li>
<li>以上的优化点都只是理论，一定要针对真实的应用场景来考量，不能乱用<br>注：使用opacity替代visibity的话，opacity一定要在特定的图层中，否则整个页面都会触发重构、回流，反之则都不会触发。<br>图层不要用太多，否则浏览器在图层的合成上就要花费很多的时间</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/14/web前端优化（3）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="朱亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朱亮的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/14/web前端优化（3）/" itemprop="url">
                  web前端优化（3）
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-11-14 18:21:45" itemprop="dateCreated datePublished" datetime="2017-11-14T18:21:45+08:00">2017-11-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-03-12 23:59:50" itemprop="dateModified" datetime="2018-03-12T23:59:50+08:00">2018-03-12</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="浏览器css和js的加载过程"><a href="#浏览器css和js的加载过程" class="headerlink" title="浏览器css和js的加载过程"></a>浏览器css和js的加载过程</h2><p><img src="http://otdc3q7z7.bkt.clouddn.com/css.js%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B.png" alt="css和html的渲染过程"></p>
<ul>
<li>浏览器通过网址首先拿到由字节流转变成字符流的HTML文档，HTML文档会被解析器解析成一段段TOKEN，浏览器通过nextToken方法，浏览器会自顶向下对HTML文档进行解析，逐渐生成DOM树，但是此时DOM树并不会在页面上进行显示</li>
<li>在生成DOM树的过程中，浏览器会对外部资源（CSS、js）进行请求和解析，对于请求的css，浏览器会生成对应的CSSOM,当CSSOM树和DOM树都生成完之后，浏览器才会将这些资源进行合并，生成RenderTree从而对页面进行绘制</li>
</ul>
<ul>
<li>HTML渲染过程中的特点<ul>
<li>是顺序执行且并发加载的</li>
<li>对于单个域名，浏览器的并发度是有限的</li>
<li>是否阻塞（css的加载是否会阻塞js的加载，css的加载是否会阻塞页面的渲染等等等）</li>
<li>依赖关系（比如css代码再哪里引入的关系，js代码的执行顺序的关系问题）</li>
<li>引入方式（link,import，script…）</li>
</ul>
</li>
</ul>
<h2 id="css、js加载过程中的优化点"><a href="#css、js加载过程中的优化点" class="headerlink" title="css、js加载过程中的优化点"></a>css、js加载过程中的优化点</h2><h2 id="懒加载和预加载"><a href="#懒加载和预加载" class="headerlink" title="懒加载和预加载"></a>懒加载和预加载</h2><ul>
<li>懒加载<ul>
<li>当页面进入可视区域之后才请求图片，对于图片很多，页面很长的业务场景适用</li>
<li>可以减少无效资源的加载</li>
<li>当并发资源过多时，会阻塞js的加载，影响网站的正常使用</li>
</ul>
</li>
<li>预加载<ul>
<li>网站的静态资源在使用之前进行提前请求</li>
<li>资源在使用时，可以直接从缓存中加载，提升用户体验</li>
<li>页面展示的依赖维护关系</li>
<li>对图片请求过程要求比较高的时候使用预加载可以提升用户体验</li>
<li>活动展示页面，就需要用预加载将图片都加载出来</li>
</ul>
</li>
<li><p>懒加载lazyload.js实现原理</p>
<ol>
<li>首先通过document的clientHeight属性获取当前的可视高度</li>
<li>选中所有带有懒加载属性的标签，循环遍历</li>
<li>通过元素的getBoundingClientRect方法获得当前元素的top值</li>
<li>如果top值小于可视界面的高度，就将设置的懒加载属性去掉，同时将src中的图片读取出来，放置在页面上<br><img src="http://otdc3q7z7.bkt.clouddn.com/F20DE3E5-747E-49B0-9BA8-CB12D242D8D2.png" alt="使用原生js实现的lazyload.js"><br>注:!function这样的写法表示在方法前加上布尔值，表示执行后面的代码，也就是合法实现调用</li>
</ol>
</li>
<li><p>预加载的实现</p>
<ol>
<li>对img标签使用display：none，将图片隐藏，但是会加载图片</li>
<li>使用js的image对象img.src去加载图片，使用的时候直接赋值即可</li>
<li>使用xmlhttprequest对象去实现,存在跨域问题，但是可以更好的控制预加载的状态</li>
<li>使用PreloadJS实现预加载</li>
</ol>
</li>
</ul>
<h2 id="懒加载与预加载案例分析"><a href="#懒加载与预加载案例分析" class="headerlink" title="懒加载与预加载案例分析"></a>懒加载与预加载案例分析</h2><ul>
<li>手淘的页面就使用的懒加载，只有当图片出现在界面的可视部分时才会加载对应的图片</li>
</ul>
<p>当</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/13/web前端优化（2）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="朱亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朱亮的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/13/web前端优化（2）/" itemprop="url">
                  web前端优化（2）
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-11-13 12:30:04" itemprop="dateCreated datePublished" datetime="2017-11-13T12:30:04+08:00">2017-11-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-23 19:31:06" itemprop="dateModified" datetime="2017-11-23T19:31:06+08:00">2017-11-23</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##图片相关优化</p>
<p>####1.图片相关优化的核心概念</p>
<p>图片压缩指的是针对图片的情况，舍弃一些相对无关紧要的色彩信息，舍去测部分人眼基本是察觉不出来的。</p>
<ul>
<li>有损压缩在压缩过程中会丢失部分图片资源，但是这部分资源对人眼来说是没有区别，所以不是很重要。</li>
</ul>
<ul>
<li>png8/png24/png32的区别<ul>
<li>png8   256色+支持透明（8bit就可以表示一个颜色）</li>
<li>png24  2^24色+不支持透明（24bit才可以显示一个像素中的颜色）</li>
<li>png32  2^24色+支持透明（在24位的基础上增加8位支持透明）</li>
<li>根据需要选择文件类型，颜色越丰富，所需的空间就越多</li>
</ul>
</li>
<li>不同格式图片常用的业务场景<ul>
<li>jpg有损压缩，压缩率高，不支持透明</li>
<li>png支持透明，浏览器兼容性好（如果png8能支持的话，那么文件大小会相对更小）</li>
<li>webp压缩程度更好，在ios webview有兼容性问题（2010年谷歌提出来的文件格式）</li>
<li>svg矢量图，代码内嵌，相对较小，图片样式相对简单的场景（svg标签在代码中进行图片的绘制，质量相对较高，iconfont这样的库就可以很好的使用svg图）</li>
<li>jpg多应用于大部分不需要透明图片的业务场景</li>
<li>png多应用于大部分需要透明图片的业务场景</li>
<li>webp多应用于安卓部分</li>
<li>svg多应用于图片样式相对简单的业务场景</li>
</ul>
</li>
<li>css雪碧图<ul>
<li>将网站要用的图片都放在一张图片上</li>
<li>可以减少网站对于图片的http请求，减少网站的请求数量</li>
<li>当雪碧图比较大时，加载会比较慢</li>
<li>一旦雪碧图加载失败，那么网站上所有的图标都会消失</li>
</ul>
</li>
<li>svg矢量图的使用<ul>
<li>svg是html5中一个比较重要的标准</li>
<li>可以使用几行代码就实现相对复杂的图标，减少页面的体积，增加网页的请求速度</li>
</ul>
</li>
</ul>
<ul>
<li>image inline 将图片的内容内嵌到html中以减少网站的http请求数量</li>
<li>image inline会将html文件变大，但是图片不大的话，基本可以忽略，但是可以减少一次http请求，所有小鱼8kb或者4kb的文件，一般是选用image inline将图片内联进来，这样减少网络请求的时间会大大小鱼html文件大小的增加的请求时间</li>
<li><a href="https://tinypng.com（图片压缩网站）" target="_blank" rel="external">https://tinypng.com（图片压缩网站）</a></li>
<li><ul>
<li><a href="https://www.spritecow.com（雪碧图制作网站）" target="_blank" rel="external">https://www.spritecow.com（雪碧图制作网站）</a></li>
</ul>
</li>
</ul>
<p>####2.facebook和淘宝移动首页案例分析</p>
<ul>
<li><p>淘宝移动端首页分析</p>
<ul>
<li>淘宝首页会自动判断是否当前浏览器是否支持webp格式图片，若是，则使用webp格式的文件，若是ios类型的浏览器，不支持webp格式的话，则自动换成jpg格式的文件</li>
<li>部分小图标使用了image inline的方式直接将图片内嵌到网页中，减少http的请求数量。 </li>
</ul>
</li>
<li><p>facebook的实例分析</p>
<ul>
<li>facebook的网站上使用的css图标是雪碧图，但是对雪碧图也做了一定的处理，将部分具有相同特性的图标放在一张雪碧图上，这样将雪碧图拆分开，增加了请求数量，但是避免了图片过大对网络的压力</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/12/web前端优化（1）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="朱亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朱亮的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/12/web前端优化（1）/" itemprop="url">
                  web前端优化小结（资源合并与压缩）
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-11-12 21:35:12" itemprop="dateCreated datePublished" datetime="2017-11-12T21:35:12+08:00">2017-11-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-14 23:04:41" itemprop="dateModified" datetime="2017-11-14T23:04:41+08:00">2017-11-14</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##资源合并与压缩</p>
<p>####1.WEB前端优化的核心概念以及意义</p>
<ul>
<li>不同于C/S架构，用户访问时的软件是访问本地的包，B/S架构是将软件包部署在服务器上， 当用户访问我们的程序时，浏览器才会动态的，增量的去向服务器发起请求。因此，WEB前端的请求是一个动态的，增量的请求过程。在这个过程中，如果我们的资源更少，http请求更快，那么我们的请求响应就会更快，用户体验就会更好。</li>
</ul>
<p>####2.HTTP请求的过程中的优化</p>
<p>*在浏览器层面，可以进行缓存，缓存请求频率比较高的资源，减少对于DNS服务器的请求。</p>
<p>*带宽层面，可以减少http请求的大小，同时将多次http请求合并成一次，减少对网络信道的损耗</p>
<p>*dns可以通过缓存减少dns查询的时间</p>
<p>*对于vue，ng这样的框架，会在浏览器端对代码进行解析，渲染，对于这样的问题，可以使用框架进行ssr（服务端渲染）加快首屏渲染，减少首屏渲染的损耗以及浏览器的压力</p>
<ul>
<li>图片和文件层面<ul>
<li>使用雪碧图</li>
<li>对于图片使用image inline的方法将图片信息内嵌到html页面中，减少请求数量</li>
<li>对于代码进行打包压缩合并，减少对于文件的请求数量</li>
</ul>
</li>
</ul>
<p>####3.压缩与合并</p>
<p>*压缩与合并可以减少http请求数量，同时也可以减少请求资源的大小</p>
<p>*html压缩</p>
<p>*css压缩</p>
<p>*js压缩和混乱</p>
<p>*文件合并</p>
<p>*谷歌在每1MB的请求中减少1字节，每年可以节省流量近500TB，每年可以减少上亿元的支出。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/25/vue全局变量无法触发热更新以及解决方案/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="朱亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朱亮的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/25/vue全局变量无法触发热更新以及解决方案/" itemprop="url">
                  vue全局变量无法触发视图更新以及解决方案
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-10-25 21:12:19" itemprop="dateCreated datePublished" datetime="2017-10-25T21:12:19+08:00">2017-10-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-10-26 12:47:18" itemprop="dateModified" datetime="2017-10-26T12:47:18+08:00">2017-10-26</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在用vue写一个图书馆的项目的时候，因为项目不是很复杂，就没有上vuex，并按照以往的习惯使用global进行全局变量的设置以及管理。按照往常的经验来说，是没有什么问题的。但是万万没想到踩到了自己挖的坑。</p>
<h2 id="1-全局变量的定义以及使用"><a href="#1-全局变量的定义以及使用" class="headerlink" title="1.全局变量的定义以及使用"></a>1.全局变量的定义以及使用</h2><p>在vue-cli生成的模板项目中，若觉得项目不是很复杂没有必要使用vuex的话，我们一般会使用一个bus.js或者global.js用来定义变量，将变量挂在在js的gloabl上，然后在入口页面直接import这个文件即可成为全局变量，这样即可实现vuex的全局变量的功能</p>
<p><img src="http://otdc3q7z7.bkt.clouddn.com/17-10-254.png" alt="全局变量定义"></p>
<p><img src="http://otdc3q7z7.bkt.clouddn.com/17-10-253.png" alt="在组件中的使用"></p>
<p>在gloabl文件中直接定义，定义完成之后再子组件的文件中，直接使用名称进行访问即可，也可以自己写get/set方法来实现变量的管理。</p>
<h2 id="2-问题的产生"><a href="#2-问题的产生" class="headerlink" title="2.问题的产生"></a>2.问题的产生</h2><p>在这次的系统中，有一个需求就是在个人中心的收藏和预定模块展示个人收藏和预定的书籍列表，如下图所示。</p>
<p><img src="http://otdc3q7z7.bkt.clouddn.com/2017-10-251.png" alt="收藏页面"></p>
<p><img src="http://otdc3q7z7.bkt.clouddn.com/2017-10-252.png" alt="书籍展示页面"></p>
<p>当在列表中点击收藏和预定按钮时，我的预定和收藏页面需要能及时刷新。而我又很作死的使用了全局变量来做列表数据存储，更作死的是我还没有用vuex及时通知组件数据的更新。。。。。。。</p>
<p>当预定列表的收藏列表的全局数组不为空时，一切都很正常，添加删除都很正常，但是当页面加载的时候，若预定和收藏的列表为空，则当用户添加的时候就无法实现双向绑定。这是问题让我很奔溃，一切都正常，只有数组初始化为空的时候无法响应。</p>
<p>coputed和watch都使用了,通过computed方法，实时打印的话可以发现数组的值已经改变，但是页面就是无法做出响应。</p>
<h2 id="3-问题的解决"><a href="#3-问题的解决" class="headerlink" title="3.问题的解决"></a>3.问题的解决</h2><p>经过无数次的尝试之后发现，当全局变变量的书籍列表数组初始化为空时，computed计算属性和watch变量都做不到监听的效果。其中，通过打印computed可以发现，数组的值是变化了，但是没有触发computed。</p>
<p><img src="http://otdc3q7z7.bkt.clouddn.com/17-10-261.png" alt="使用过computed监听"></p>
<p>最后，我想到既然有数据时是正常的，那么是不是我的数组初始化不为空就可以了，所以我给数组增加了一个默认的变量，这样，即使用户没有收藏的书籍，数组也不会为空。果然，问题也得到了解决。</p>
<h2 id="4-感想"><a href="#4-感想" class="headerlink" title="4.感想"></a>4.感想</h2><p>或许这种时候使用vuex就不会那么麻烦了吧，总感觉这种解决方案比较low，后续准备继续研究，找出问题的关键所在。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/26/spring的跨域/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="朱亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朱亮的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/26/spring的跨域/" itemprop="url">
                  浅谈跨域问题
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-09-26 23:10:06" itemprop="dateCreated datePublished" datetime="2017-09-26T23:10:06+08:00">2017-09-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-10-07 10:40:01" itemprop="dateModified" datetime="2017-10-07T10:40:01+08:00">2017-10-07</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>  &emsp;&emsp;&emsp;&emsp;对于前端开发的码农们，跨域问题一定不陌生，在我还是个新手时，就曾被跨域问题折磨的欲仙欲死。</p>
<p>  &emsp;&emsp;&emsp;&emsp;之前项目开发时，使用了CORS（跨域资源共享），虽然对低版本的IE兼容性有一定的限制，但是胜在方便，能轻松的解决跨域问题。今天突然想起这一茬，决定进行一个详细的记录。</p>
<p>  &emsp;&emsp;&emsp;&emsp;只要协议、域名、端口有任何一个不同，都被当作是不同的域。即在一个域下的js无法访问不同域下的数据对象。这是浏览器出于安全考虑的做法，几乎所有的浏览器都不允许这种跨域访问。所以当你需要访问其他域名的接口时，这个问题就出现了，这也是本文要探讨的问题。</p>
<h2 id="1-jsonp解决方案"><a href="#1-jsonp解决方案" class="headerlink" title="1.jsonp解决方案"></a>1.jsonp解决方案</h2><p>   首先介绍jsonp的解决方案，这也是我之前的几个项目一直使用的方案。<br>   上文中说过，浏览器禁止跨域访问数据。但是script标签却可以不受这个规则的限制。而jsonp正是利用了这个“漏洞”，从而实现与其他域进行通讯的需求。这也是一些卓越的工程师们想出来“逃避”同源策略的有效方法。</p>
<p>   jsonp的要点是允许客户端传一个callback给服务器，然后服务器返回这个callback包裹着json给客户端，客户端执行这个回调函数。所以jsonp可以理解为json with padding.</p>
<ul>
<li><p><code>-</code> jsonp的优点</p>
<ul>
<li>纯文本的方式，跨平台简单</li>
<li>javascript原生支持，兼容性好</li>
</ul>
</li>
<li><p><code>-</code> jsonp的缺点</p>
<ul>
<li>只支持get请求，不支持其他类型的请求</li>
<li>调用失败时，不会返回失败的状态码</li>
<li>安全问题，当调用的服务存在页面注入漏洞，即返回的JS可能是被人控制的，所以使用jsonp的服务必须保证是安全可靠的</li>
</ul>
</li>
</ul>
<h2 id="2-CORS跨域资源共享"><a href="#2-CORS跨域资源共享" class="headerlink" title="2.CORS跨域资源共享"></a>2.CORS跨域资源共享</h2><p>   CORS是W3C官方的解决方案，全称是“跨域资源共享”，CORS需要浏览器端和服务器端同时支持，目前除了IE9以下的浏览器都是支持CORS方案的，所以只要是服务器端实现了CORS接口的即可进行调用。CORS通信和ajax通信代码完全一样，无需进行特别处理，这也是非常方便的地方。</p>
<h3 id="CORS的请求类型"><a href="#CORS的请求类型" class="headerlink" title="CORS的请求类型"></a>CORS的请求类型</h3><p>CORS请求类型氛围两种</p>
<ul>
<li>简单请求<ul>
<li>（1) 请求方法是以下三种方法之一：<ul>
<li>HEAD</li>
<li>GET</li>
<li>POST</li>
</ul>
</li>
<li>（2）HTTP的头信息不超出以下几种字段：<ul>
<li>Accept</li>
<li>Accept-Language</li>
</ul>
</li>
</ul>
<ul>
<li>Content-Language<ul>
<li>Last-Event-ID</li>
<li>Content-Type：只限于三个值application/x-www-form-urlencoded、multipart/form-data、text/plain</li>
</ul>
</li>
</ul>
<ul>
<li>非简单请求</li>
</ul>
</li>
<li><p>凡是不同时满足以上两个条件的请求就是非简单请求。</p>
<p>如果是简单请求，浏览器会直接发送跨域请求并在请求头部增加Origin字段用来表明该请求来自哪个个源（协议 + 域名 + 端口）。而服务器端直接根据这个参数来判断是否需要给予响应。如果是不被允许的，则服务器端返回的结果则不携带ccess-Control-Allow-Origin字段，浏览器端发现没有这个字段就知道出错了，直接捕获并报错。</p>
<p>而对于非简单请求则会稍微复杂些</p>
<p>非简单请求是那种对服务器有特殊要求的请求，比如请求方法是PUT或DELETE，或者Content-Type字段的类型是application/json。</p>
<p>非简单请求在请求之前，都会发送一次预检（option）请求。<br><img src="http://otdc3q7z7.bkt.clouddn.com/D2305456-6299-473D-A20B-FA310F682C57.png" alt="option预检请求"><br>当服务器确认并成功返回之后，真正的请求才会被发送出去。<br><img src="http://otdc3q7z7.bkt.clouddn.com/4AFD7E9A-BD69-46AD-A596-5F62E06BC795.png" alt="正式请求"></p>
</li>
</ul>
<h3 id="CORS对于cookie的处理"><a href="#CORS对于cookie的处理" class="headerlink" title="CORS对于cookie的处理"></a>CORS对于cookie的处理</h3><p>CORS请求默认不发送Cookie和HTTP认证信息。如果要把Cookie发到服务器，一方面要服务器同意，指定Access-Control-Allow-Credentials字段。</p>
<pre><code>Access-Control-Allow-Credentials: true
</code></pre><p>另一方面，开发者必须在AJAX请求中打开withCredentials属性。</p>
<pre><code>var xhr = new XMLHttpRequest();
xhr.withCredentials = true;
</code></pre><p>否则，即使服务器同意发送Cookie，浏览器也不会发送。或者，服务器要求设置Cookie，浏览器也不会处理。<br>但是，如果省略withCredentials设置，有的浏览器还是会一起发送Cookie。这时，可以显式关闭withCredentials。</p>
<pre><code>xhr.withCredentials = false;
</code></pre><p>需要注意的是，如果要发送Cookie，Access-Control-Allow-Origin就不能设为星号，必须指定明确的、与请求网页一致的域名。同时，Cookie依然遵循同源政策，只有用服务器域名设置的Cookie才会上传，其他域名的Cookie并不会上传，且（跨源）原网页代码中的document.cookie也无法读取服务器域名下的Cookie</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  

<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
<div class="widget-wrap">
    <div id="myCanvasContainer" class="widget tagcloud" style="text-align:center;">
        <canvas width="400" height="200" id="resCanvas" style="width=100%">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ajax知识点整理/">ajax知识点整理</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css和js部分的优化相关/">css和js部分的优化相关</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css相关/">css相关</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html相关强化/">html相关强化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js设计模式小计/">js设计模式小计</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nuxt学习笔记/">nuxt学习笔记</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/service-worker实战/">service worker实战</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuepress学习小计/">vuepress学习小计</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/一本需要反复阅读的js书籍/">一本需要反复阅读的js书籍</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/代码编写过程中的沉淀/">代码编写过程中的沉淀</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端知识点沉淀/">前端知识点沉淀</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/图片相关/">图片相关</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/总的来说，这本书有点脱节了，内容有些老旧/">总的来说，这本书有点脱节了，内容有些老旧</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/服务端性能优化/">服务端性能优化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/浏览器中各种距离的计算/">浏览器中各种距离的计算</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/浏览器存储和缓存/">浏览器存储和缓存</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/看vue-js一书所得/">看vue.js一书所得</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/缓存相关/">缓存相关</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/重绘与回流相关/">重绘与回流相关</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试记录/">面试记录</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高性能javascript一书阅读笔记/">高性能javascript一书阅读笔记</a><span class="tag-list-count">1</span></li></ul>
        </canvas>
    </div>
</div>


  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>



  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/head.jpg"
                alt="朱亮" />
            
              <p class="site-author-name" itemprop="name">朱亮</p>
              <p class="site-description motion-element" itemprop="description">Leon Zhu’s blog | 爱前端 | 爱生活</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">34</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">21</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/Lenozhu" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:zl937154020@163.com" target="_blank" title="E-Mail" rel="external nofollow"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://juejin.im/user/576bcf062e958a005717bb94" target="_blank" title="掘金" rel="external nofollow"><i class="fa fa-fw fa-globe"></i>掘金</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">朱亮</span>



  

  
</div>


  






        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      用户总数<span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
|
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      访问总数<span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  













  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.2.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.2.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.2.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
